{# render_branch is a macro to recursively render the hierarchy of navbar elements #}
{% macro render_branch(samps) %}
    {% for s in samps|sort(attribute=order, reverse=True if order=='last_action_date' else False) %}
        {% if not s.isarchived or showarchived %}
            <div class="nav-container" id="nav-container{{ s.id }}">
                <div class="row nav-entry nav-dropzone {% if s.isarchived %}nav-entry-archived{% endif %}" data-id="{{ s.id }}" data-toggle="collapse" data-target="#nav-children{{ s.id }}" draggable="true">
                    <div class="nav-entry-name">{{ s.name }}</div>
                    {% if s.owner != current_user %}
                        <div class="nav-entry-owner">{{ s.owner.username }}</div>
                    {% endif %}
                </div>
                <div id="nav-children{{ s.id }}" class="row-fluid collapse out" style="padding-left: 10px;">
                    {{ render_branch(s.children) }}
                </div>
            </div>
        {% endif %}
    {% endfor %}
{% endmacro %}

{# HTML for navbar #}
<div class="navbar-shortcuts">
    <span class="left">
        <a href="/newsample" data-toggle="tooltip" title="New sample"><i class="glyphicon glyphicon-plus"></i></a>
    </span>
    <span class="right">
        &nbsp;<i class="navbar-shortcut navbar-togglearchived glyphicon glyphicon-eye-{{ 'open' if showarchived else 'close' }}" title="{{ 'Hide' if showarchived else 'Show' }} archived"></i>
        &nbsp;<i class="navbar-shortcut navbar-sort-az glyphicon glyphicon-sort-by-alphabet" title="Sort alphabetically"></i>
        &nbsp;<i class="navbar-shortcut navbar-sort-id glyphicon glyphicon-sort-by-order" title="Sort by ID"></i>
        &nbsp;<i class="navbar-shortcut navbar-sort-lastaction glyphicon glyphicon-calendar" title="Sort by last action"></i>
    </span>
</div>
<div class="navbar-clear"></div>
<div class="nav-main-container container-fluid nav-dropzone" data-id="0">
    <div class="row nav-heading">My samples:</div>
    <div id="nav-mysamples">{{ render_branch(samples) }}</div>
    {% if shares %}
        <div class="row nav-heading">Shares:</div>
        {{ render_branch(shares) }}
    {% endif %}
    {% if inheritance %}
        <div class="row nav-heading">Inheritance:</div>
        {% for i in inheritance %}
            <div class="row inheritance" data-userid="{{ i.id }}">
                <img src="{{ url_for('static', filename='user.png') }}" width="30">{{ i.username }}
            </div>
        {% endfor %}
    {% endif %}
</div>
