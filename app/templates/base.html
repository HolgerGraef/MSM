{% extends "bootstrap/base.html" %}

{% block title %}{% if sample is defined and sample is not none %}MSM - {{ sample.name }}{% else %}Mercury Sample Manager{% endif %}{% endblock %}

{% block styles %}
    {{super()}}
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{url_for('static', filename='dashboard.css')}}">
    <link rel="stylesheet" href="{{url_for('static', filename='typeahead.css')}}">
{% endblock %}

{% block navbar %}
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Mercury Sample Manager</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                {% if current_user.is_admin %}
                    <li><a href="/settings/overview"><i class="hidden-xs glyphicon glyphicon-wrench" title="Settings"></i><span class="visible-xs-block">Settings</span></a></li>
                {% endif %}
                <li><a href="/print"><i class="hidden-xs glyphicon glyphicon-print" title="Print"></i><span class="visible-xs-block">Print</span></a></li>
                <li><a href="/profile/overview"><i class="hidden-xs glyphicon glyphicon-user" title="Profile"></i><span class="visible-xs-block">Profile</span></a></li>
                <li><a href="{{ url_for('auth.logout') }}"><i class="hidden-xs glyphicon glyphicon-log-out" title="Sign out"></i><span class="visible-xs-block">Sign out</span></a></li>
                <li><a href="/help"><i class="hidden-xs glyphicon glyphicon-question-sign" title="Help"></i><span class="visible-xs-block">Help</span></a></li>
            </ul>
            <form class="nav navbar-form navbar-right"><input type="text" class="form-control searchfield" placeholder="Search..."></form>
        </div>
    </div>
</nav>
{% endblock %}

{% set begin_flashmsg = "<div class='alert alert-warning col-sm-9 col-md-10'><button type='button' class='close' data-dismiss='alert'>&times;</button>" %}
{% set end_flashmsg = "</div>" %}
{% block content %}
<div class="container-fluid">
  <div class="row">
    {% block sidebarnav %}{% endblock %}
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
      <div class="container" id="flashmessages">
        {% for message in get_flashed_messages() %}
        {{ begin_flashmsg|safe }}
        {{ message }}
        {{ end_flashmsg|safe }}
        {% endfor %}
      </div>
    {% block page_content %}{% endblock %}
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
    <script src="{{ url_for('static', filename='typeahead.js/typeahead.bundle.min.js') }}"></script>
    <script type="text/javascript" charset="utf-8">
    $(function() {
        $(document).ready(function() {
            var samples = new Bloodhound({
              datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
              queryTokenizer: Bloodhound.tokenizers.whitespace,
              remote: {
                url: '/search?autocomplete&term=%QUERY',
                wildcard: '%QUERY',
                  transform: function(data) { return data.results; }
              }
            });

            $('.searchfield').typeahead({
                minLength: 1,
                highlight: true
            },
            {
                name: 'samples',
                display: function(data) { return data.label; },
                source: samples,
                templates: {
                    suggestion: function(data) {
                        return '<div><img src="/static/sample.png" width="24px" height="24px">' + data.label + '</div>';
                    }
                }
            });

            $('.searchfield').bind('typeahead:select', function(event, suggestion) {
                location.href="/sample/"+suggestion.id;
            });

            $('.searchfield').keypress(function(event) {
                if (event.which == 13) {
                    location.href="/search?term="+$(this).val();
                }
            });
        });
    });
    </script>
{% endblock %}
